# 多Sheet页处理功能说明

## 功能概述

程序现在支持处理Excel文件中的多个sheet页，根据sheet名称自动判断处理策略和项目名提取方式。

## 处理规则

### 情况1: 非标准sheet命名（自定义sheet名）

**判断条件**: Excel文件中存在至少一个sheet名称不是"sheet1"、"sheet2"...格式

**处理策略**:
- ✅ 处理所有非"sheet[1-9]"格式的sheet页
- ✅ 每个sheet独立提取数据
- ✅ 项目名从**sheet名称**的汉字部分提取

**示例**:
```
Excel文件: 理化数据处理模板.xlsx
├── 项目A_sheet2      ← 处理此sheet，项目名="项目A"
├── 项目B测试         ← 处理此sheet，项目名="项目B测试"
└── sheet1           ← 跳过（标准命名）
```

### 情况2: 标准sheet命名

**判断条件**: Excel文件中所有sheet都是"sheet1"、"sheet2"...格式（不区分大小写）

**处理策略**:
- ✅ 只处理"sheet1"页
- ✅ 忽略其他sheet页（sheet2, sheet3...）
- ✅ 项目名从**文件名**的汉字部分提取

**示例**:
```
Excel文件: 理化数据处理模板飘红为统一要求.xls
├── Sheet1           ← 处理此sheet，项目名="理化数据处理模板飘红为统一要求"
├── Sheet2           ← 跳过
└── Sheet3           ← 跳过
```

## 项目名提取规则

### 从Sheet名称提取（情况1）
```python
sheet名称: "项目A_sheet2"  → 项目名: "项目A"
sheet名称: "COD分析结果"   → 项目名: "COD分析结果"
sheet名称: "Data_2024测试" → 项目名: "测试"
```

### 从文件名提取（情况2）
```python
文件名: "理化数据处理模板——飘红.xls"
→ 项目名: "理化数据处理模板飘红"
```

## 代码修改内容

### 1. 新增函数 `get_sheets_to_process(file_path)`
- 自动检测Excel文件中的所有sheet页
- 判断sheet命名模式
- 返回需要处理的sheet列表及项目名提取策略

### 2. 修改函数 `extract_sample_and_concentration()`
- 新增参数 `sheet_name`: 指定要读取的sheet名称
- 支持从指定sheet读取数据
- 同时支持 `.xlsx` 和 `.xls` 格式

### 3. 修改主流程
- 遍历每个Excel文件时，先获取要处理的sheet列表
- 对每个sheet单独提取数据
- 根据策略从sheet名称或文件名提取项目名

## 输出示例

### 情况1输出
```
处理文件: C:/path/to/水质分析.xlsx
处理Sheet: 项目A_COD
✓ 使用第 8 行作为列名
✓ 找到样品编号列: '样品编号'
✓ 找到浓度列: '样品浓度（mg/L）'
符合条件的数据 (共 2 行): [项目名=项目A]

处理文件: C:/path/to/水质分析.xlsx
处理Sheet: 项目B_氨氮
✓ 使用第 8 行作为列名
符合条件的数据 (共 3 行): [项目名=项目B]
```

### 情况2输出
```
处理文件: C:/path/to/理化数据处理模板.xls
处理Sheet: Sheet1
✓ 使用第 8 行作为列名
符合条件的数据 (共 1 行): [项目名=理化数据处理模板]
```

## 最终输出Excel结构

| 分析人 | 分析日期 | 项目名 | 样品编号 | 样品浓度 |
|--------|----------|--------|----------|----------|
| 张三   | 2024-01-15 | 项目A | FS2530010101 | 101 |
| 张三   | 2024-01-15 | 项目B | FS2530010102 | 95  |
| 李四   | 2024-01-16 | 理化数据 | FS2530010103 | 88 |

## 注意事项

1. **Sheet名称判断不区分大小写**: "Sheet1"、"sheet1"、"SHEET1" 都被视为标准命名
2. **只提取汉字**: 项目名只保留中文字符，英文、数字、符号会被过滤
3. **数据独立处理**: 每个sheet的数据独立提取，互不影响
4. **元数据共享**: 同一个Excel文件的所有sheet共享同一份元数据（分析人、分析日期）

## 测试建议

1. **测试混合命名**:
   - 创建包含"项目A"、"项目B"、"sheet3"的Excel文件
   - 验证只处理"项目A"和"项目B"

2. **测试纯标准命名**:
   - 创建只包含"Sheet1"、"Sheet2"的Excel文件
   - 验证只处理"Sheet1"且项目名来自文件名

3. **测试特殊字符**:
   - Sheet名称: "项目_A-测试2024"
   - 验证项目名提取为"项目测试"
