# WL 提取脚本使用说明

本项目提供一个简单的 Excel 提取脚本，用于在一个文件夹下批量读取检测报表，并汇总指定样品编号（默认提取 DX2509530201 与 DX2509530301）的浓度结果。

## 运行环境

- Python 3.10+（项目设置为 >=3.13，低版本如 3.10/3.11 通常也可运行）
- 依赖：pandas、openpyxl

安装依赖（Windows PowerShell）：

```powershell
py -m pip install --upgrade pip
py -m pip install pandas openpyxl
```

## 如何运行

```powershell
py .\main.py
```

## 工作流程

### 第1步：选择输入源
弹出对话框提示：**选择文件夹还是单个文件？**
- **是** → 选择包含多个 Excel 的文件夹（批量处理）
- **否** → 选择单个 Excel 文件（仅处理该文件）

### 第2步：输入样品编号
弹出对话框提示：**选择编号输入方式？**

#### 方式 1：直接输入（选"是"）
在对话框中输入多个编号，用以下分隔符分开：
- 逗号：`DX2509530201, DX2509530301`
- 空格：`DX2509530201 DX2509530301`
- 分号：`DX2509530201; DX2509530301`
- 中文逗号：`DX2509530201，DX2509530301`
- 换行：
  ```
  DX2509530201
  DX2509530301
  ```

#### 方式 2：从 TXT 文件导入（选"否"）
选择一个 TXT 文件，每行一个编号。

**示例文件 `sample_ids.txt`：**
```
DX2509530201
DX2509530301

# 以#开头的行为注释，会被忽略
# DX2509530101
```

### 第3步：处理与汇总
- 程序自动识别"样品编号"和"浓度"两列（支持多种列名）
- 排除编号包含 KB/PS 的行
- 仅保留匹配指定编号的记录（支持去除"平行1/2"等后缀进行规范化匹配）

### 第4步：指定输出
1. 选择保存文件夹
2. 输入文件名（不带 `.xlsx` 后缀，或留空使用默认名）
3. 若文件已存在，会询问是否覆盖

最终输出文件包含列：**项目名**、**样品编号**、**浓度**

## 常见问题

- 如果某些表的列名不一致（例如"样品名称""浓度mg/L"等），脚本会自动尝试识别；若仍识别失败，终端会提示该表可用列名。
- 如果同一样品存在"平行1/平行2"等行且有空值，脚本会尝试用同组平行样品的浓度进行填充后再汇总。
- TXT 文件支持以 `#` 开头的注释行，空行会被忽略。

## TXT 文件格式说明

- **每行一个编号**，不支持分隔符
- **空行会被忽略**
- **以 `#` 开头的行为注释，会被忽略**
- **自动转大写**，不区分大小写
- **自动去重**，相同编号只保留一次

