# 元数据提取功能说明

## 功能概述

程序现在会从每个Excel文件的sheet页中提取以下元数据信息,并作为独立列添加到最终输出文件中。

## 提取的元数据字段

| 序号 | 字段名称 | 对应Excel标签 | 说明 |
|-----|---------|--------------|------|
| 1 | 分析人 | "分析人" 或 "分析人员" | 执行分析的人员姓名 |
| 2 | 仪器编号 | "仪器编号" 或 "仪器型号" 或 "使用仪器" | 使用的仪器设备编号 |
| 3 | 分析方法 | "分析方法" | 使用的分析方法标准 |
| 4 | 检出限 | "检出限" | 方法检出限数值 |
| 5 | 分析日期 | "分析日期" | 分析执行日期 |

## 提取规则

### 1. **按sheet页独立提取**
每个sheet页的元数据都是从**该sheet页内**独立提取的,不会跨sheet共享。

```
Excel文件: 水质分析.xlsx
├── 项目A_COD     → 从该sheet页提取元数据
│   └── 分析人: 张三, 仪器编号: LC-20A, ...
└── 项目B_氨氮    → 从该sheet页提取元数据
    └── 分析人: 李四, 仪器编号: AA-6800, ...
```

### 2. **标签查找方式**
- 在sheet的**前100行**内查找标签名称
- 找到标签后,提取其**右侧相邻单元格**的值
- 支持多个标签名称映射到同一字段(如"分析人"和"分析人员")

### 3. **优先级规则**
如果同一个字段存在多个标签(如"仪器编号"和"使用仪器"),**先找到的值优先**,后续不会覆盖。

### 4. **缺失值处理**
如果某个字段在sheet中找不到对应标签,该字段值为**空字符串**。

## 输出Excel结构

最终输出的Excel文件包含以下8列:

| 列名 | 来源 | 说明 |
|-----|------|------|
| 分析人 | 元数据 | 从sheet页提取 |
| 仪器编号 | 元数据 | 从sheet页提取 |
| 分析方法 | 元数据 | 从sheet页提取 |
| 检出限 | 元数据 | 从sheet页提取 |
| 分析日期 | 元数据 | 从sheet页提取 |
| 项目名 | sheet名称或文件名 | 根据规则提取汉字部分 |
| 样品编号 | 数据表 | 从数据表中提取 |
| 样品浓度 | 数据表 | 从数据表中提取(四舍五入到整数) |

## 示例输出

### 输入: Excel文件结构

```
文件: 理化数据分析.xlsx
Sheet: 项目A_COD

┌──────────────────────────────────────┐
│ 检测项目：     苯并芘                  │
│ 分析人员：     刘敬波                  │
│ 使用仪器：     LC-20A 紫外            │
│ 仪器编号：     HNZYT'SB-HJ-057        │
│ 分析方法：     HJ 478-2009            │
│ 检出限：       0.004 μg/L             │
│ 分析日期：     2025.8.1               │
├──────────────────────────────────────┤
│ 样品编号    │ 样品浓度（mg/L）        │
│ DX2523660101│ 100.5312               │
│ DX2523660201│ 95.2187                │
└──────────────────────────────────────┘
```

### 输出: 提取结果

| 分析人 | 仪器编号 | 分析方法 | 检出限 | 分析日期 | 项目名 | 样品编号 | 样品浓度 |
|-------|---------|---------|-------|---------|--------|----------|---------|
| 刘敬波 | HNZYT'SB-HJ-057 | HJ 478-2009 | 0.004 μg/L | 2025.8.1 | 项目 | DX2523660101 | 101 |
| 刘敬波 | HNZYT'SB-HJ-057 | HJ 478-2009 | 0.004 μg/L | 2025.8.1 | 项目 | DX2523660201 | 95 |

## 标签匹配表

| 字段 | 可识别的标签名称 |
|-----|----------------|
| 分析人 | "分析人", "分析人员" |
| 仪器编号 | "仪器编号", "仪器型号", "使用仪器" |
| 分析方法 | "分析方法" |
| 检出限 | "检出限" |
| 分析日期 | "分析日期" |

## 注意事项

1. **标签必须精确匹配**: 标签名称必须与上表中的名称完全一致(支持的变体除外)
2. **右侧取值**: 值必须在标签的**右侧相邻单元格**
3. **前100行限制**: 只在每个sheet的前100行内查找标签
4. **支持两种格式**: 同时支持 `.xlsx` 和 `.xls` 文件
5. **每sheet独立**: 多个sheet的元数据互不影响

## 测试建议

准备一个测试Excel文件,包含:
- ✅ 所有5个元数据字段的标签和值
- ✅ 多个sheet页,每个sheet有不同的元数据
- ✅ 测试缺失某些字段的情况
- ✅ 测试标签别名(如"分析人员"vs"分析人")

运行程序后检查输出Excel是否正确包含所有8列数据。
